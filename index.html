<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Selamat Ulang Tahun ‚Äî E-Card</title>
  <meta name="theme-color" content="#ff6b9a">
  <style>
    /* Pink-first, mobile-first layout + fullscreen on phone */
    :root{
      --bg-1: #fff0f6;      /* soft pink */
      --bg-2: #ffe6f0;      /* lighter pink */
      --card-bg: #fff;      /* card background (light) */
      --accent: #ff6b9a;    /* main pink accent */
      --accent-2: #ff9ac9;  /* secondary pink */
      --muted: #5b2b38;     /* dark pink/burgundy text */
      --glass: rgba(255,255,255,0.6);
    }

    /* Reset & base */
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;}
    body{
      background: linear-gradient(180deg,var(--bg-1),var(--bg-2));
      color:var(--muted);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      padding:0;
      display:flex;
      align-items:center;
      justify-content:center;
      min-height:100svh;
    }

    /* App wrapper */
    .wrap{width:100%;max-width:1000px;padding:14px}

    /* Grid desktop, single column mobile */
    .grid{display:grid;grid-template-columns:420px 1fr;gap:18px}
    .panel{border-radius:14px;padding:14px;background:linear-gradient(180deg, rgba(255,255,255,0.8), rgba(255,255,255,0.85));box-shadow: 0 8px 30px rgba(120,30,70,0.06);border:1px solid rgba(255,255,255,0.7)}
    .panel.left{height:720px;display:flex;flex-direction:column;gap:12px}
    .panel.preview{height:720px;position:relative;overflow:hidden;padding:0}

    /* Controls (left) */
    .form-row{display:flex;gap:8px;align-items:center}
    label{font-size:13px;color:rgba(91,43,56,0.9);min-width:84px}
    input[type="text"], textarea{background:transparent;border:1px solid rgba(91,43,56,0.06);color:var(--muted);padding:10px;border-radius:8px;flex:1}
    textarea{min-height:84px;resize:vertical}
    .small{font-size:12px;color:rgba(91,43,56,0.85)}
    .btn{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:white;padding:8px 12px;border-radius:10px;border:0;cursor:pointer;font-weight:700}
    .btn.ghost{background:transparent;border:1px solid rgba(91,43,56,0.06);color:var(--muted)}

    /* Preview card (right) - mobile-first full screen */
    .card{
      height:100%;
      width:100%;
      display:flex;
      flex-direction:column;
      justify-content:flex-start;
      padding:18px;
      gap:12px;
      background:linear-gradient(180deg, rgba(255,255,255,0.96), rgba(255,246,250,0.98));
    }
    .top{display:flex;gap:12px;align-items:center}
    .avatar{width:96px;height:96px;border-radius:12px;overflow:hidden;border:3px solid rgba(255,155,170,0.12);flex:0 0 96px;background:linear-gradient(90deg,#ffd8e8,#fff)}
    .avatar img{width:100%;height:100%;object-fit:cover;display:block}
    .title h1{margin:0;font-size:20px;color: #5b2b38}
    .title p{margin:6px 0 0;color:rgba(91,43,56,0.7);font-size:13px}
    .from-box{margin-left:auto;text-align:right;color:rgba(91,43,56,0.9);font-weight:700}

    .slideshow{height:260px;border-radius:12px;overflow:hidden;border:1px solid rgba(91,43,56,0.04);position:relative;background:linear-gradient(90deg,#fff0f6,#fff6fb)}
    .slide{width:100%;height:100%;position:absolute;inset:0;display:flex;align-items:center;justify-content:center;transition:opacity .45s,transform .45s;opacity:0;transform:scale(1.02)}
    .slide.active{opacity:1;transform:scale(1)}
    .slide img{width:100%;height:100%;object-fit:cover;display:block}

    .controls-bottom{display:flex;gap:8px;align-items:center;justify-content:space-between;margin-top:8px;padding:0 2px}
    .small-btn{background:transparent;border:1px solid rgba(91,43,56,0.06);padding:6px 8px;border-radius:8px;color:var(--muted);cursor:pointer}

    .blocks{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:8px}
    .block{padding:12px;border-radius:10px;background:linear-gradient(180deg,rgba(255,242,247,0.7),rgba(255,246,250,0.8));border:1px solid rgba(91,43,56,0.03)}
    .block h3{margin:0 0 8px;font-size:15px;color: #5b2b38}
    .option{display:block;background:transparent;border:1px solid rgba(91,43,56,0.04);padding:8px;border-radius:8px;margin-bottom:8px;cursor:pointer;color:var(--muted)}
    .option.correct{border-color:rgba(110,231,183,0.9);background:rgba(110,231,183,0.06)}
    .option.wrong{border-color:rgba(255,107,129,0.9);background:rgba(255,107,129,0.04)}

    /* hearts */
    .hearts-row{display:flex;gap:6px;align-items:center}
    .heart-btn{font-size:20px;cursor:pointer;opacity:.95;transition:transform .12s}

    /* overlay modal for secret message (full-screen on phone) */
    .overlay{
      position:fixed;inset:0;display:flex;align-items:center;justify-content:center;
      background:linear-gradient(180deg, rgba(30,10,20,0.45), rgba(30,10,20,0.6));
      opacity:0;pointer-events:none;transition:opacity .25s;z-index:50;
    }
    .overlay.show{opacity:1;pointer-events:auto}
    .modal{background:linear-gradient(180deg,#fff,#fff7fb);padding:18px;border-radius:12px;border:1px solid rgba(91,43,56,0.06);text-align:center;max-width:720px;max-height:90vh;overflow:auto}

    /* mobile controls drawer (used on small screens) */
    .mobile-controls{
      display:none;
      position:fixed;
      left:0;right:0;bottom:0;
      background:linear-gradient(180deg,#fff,#fff7fb);
      border-top-left-radius:14px;border-top-right-radius:14px;
      padding:12px;box-shadow:0 -10px 40px rgba(120,30,70,0.08);
      z-index:60;
      transform:translateY(100%);
      transition:transform .25s;
      max-height:84vh;overflow:auto;
    }
    .mobile-controls.show{transform:translateY(0)}
    .edit-btn{
      position:fixed;left:16px;bottom:16px;background:linear-gradient(90deg,var(--accent),var(--accent-2));
      color:white;padding:12px 14px;border-radius:12px;border:0;cursor:pointer;z-index:80;box-shadow:0 10px 30px rgba(255,105,150,0.14)
    }

    /* floating open surprise button (big) */
    .open-btn{
      position:fixed;right:16px;bottom:16px;background:linear-gradient(90deg,var(--accent-2),var(--accent));
      color:white;padding:14px 16px;border-radius:14px;border:0;cursor:pointer;z-index:80;font-weight:800;box-shadow:0 14px 40px rgba(255,105,150,0.16)
    }

    /* responsive rules */
    @media (max-width:980px){
      .grid{grid-template-columns:1fr;gap:12px}
      .panel.left{display:none} /* hide left controls on small screens */
      .panel.preview{height:calc(100svh - 28px)} /* nearly fullscreen preview */
      .wrap{padding:8px}
      .mobile-controls{display:block}
    }

    @media (prefers-color-scheme:dark){
      :root{
        --bg-1:#1b0410;
        --bg-2:#2b0818;
        --card-bg: #1a0710;
        --muted:#ffdff0;
        --glass: rgba(255,255,255,0.04);
      }
      body{background: linear-gradient(180deg,var(--bg-1),var(--bg-2))}
      .panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));}
    }

    /* small helpers */
    .muted{color:rgba(91,43,56,0.6);font-size:13px}
    .center{text-align:center}
  </style>
</head>
<body>
  <div class="wrap">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
      <div>
        <strong style="font-size:18px;color:var(--muted)">E-Card Interaktif ‚Äî Ultah</strong>
        <div class="small muted">Tampilan mobile full & nuansa pink</div>
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <button class="btn ghost" id="resetBtn">Reset</button>
      </div>
    </div>

    <div class="grid">
      <!-- Left: Desktop controls (hidden on mobile) -->
      <div class="panel left" id="leftControls">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <strong>Personalisasi</strong>
          <div class="small muted">Edit langsung</div>
        </div>

        <div style="margin-top:8px">
          <div class="form-row"><label>Nama</label><input id="inpName" type="text" value="Sayang"></div>
          <div class="form-row" style="margin-top:6px"><label>Dari</label><input id="inpFrom" type="text" value="Nama Kamu"></div>
          <div style="margin-top:8px"><label style="display:block;margin-bottom:6px">Pesan</label><textarea id="inpMsg">Semoga hari ini penuh cinta dan tawa. Aku sayang kamu.</textarea></div>
          <div style="margin-top:8px" class="form-row"><label>Foto (URL)</label><input id="inpPhoto" type="text" value="https://images.unsplash.com/photo-1524504388940-b1c1722653e1?q=80&w=1200&auto=format&fit=crop&ixlib=rb-4.0.3&s=placeholder"></div>
          <div style="margin-top:8px" class="form-row"><label>Musik (MP3)</label><input id="inpMusic" type="text" placeholder="https://.../lagu.mp3"></div>
          <div style="display:flex;gap:8px;margin-top:10px">
            <button class="btn" id="applyBtn">Terapkan</button>
            <button class="btn ghost" id="addSlideBtn">Tambah Slide</button>
          </div>
        </div>

        <hr style="border:none;border-top:1px solid rgba(91,43,56,0.06);margin:8px 0">

        <div><strong>Pengaturan Kejutan</strong></div>
        <div class="small muted" style="margin-bottom:8px">PIN untuk membuka catatan</div>
        <div class="form-row"><label>PIN</label><input id="inpPin" type="text" value="1995"></div>

        <div style="margin-top:8px">
          <strong>Quiz</strong>
          <textarea id="quizJson" style="width:100%;min-height:120px;background:transparent;border:1px solid rgba(91,43,56,0.06);padding:8px;border-radius:8px">
[ 
  {"q":"Di mana kita pertama kali bertemu?","opts":["Kafe","Kampus","Taman"],"a":0},
  {"q":"Makanan favorit dia?","opts":["Sushi","Nasi Goreng","Pizza"],"a":1},
  {"q":"Warna yang dia suka?","opts":["Biru","Merah","Hijau"],"a":0}
]
          </textarea>
          <div style="display:flex;gap:8px;margin-top:8px">
            <button class="btn" id="loadQuizBtn">Muat Quiz</button>
            <button class="btn ghost" id="clearProgressBtn">Kosongkan Progress</button>
          </div>
        </div>

        <div style="margin-top:auto" class="small muted">
          Tip: pada HP, tekan tombol edit (kiri bawah) untuk membuka panel personalisasi.
        </div>
      </div>

      <!-- Right: Preview -->
      <div class="panel preview">
        <div class="card" id="card">
          <div class="top">
            <div class="avatar"><img id="avatarImg" src=""></div>
            <div class="title">
              <h1 id="titleText">Selamat Ulang Tahun, Sayang üéâ</h1>
              <p id="subText" class="small muted">Keindahan kecil untuk hari besarmu</p>
            </div>
            <div class="from-box">
              <div class="small muted">Dari</div>
              <div id="fromText">Nama Kamu</div>
            </div>
          </div>

          <div class="slideshow" id="slideshow"></div>

          <div class="controls-bottom">
            <div>
              <button class="small-btn" id="prevSlide">‚óÄ Prev</button>
              <button class="small-btn" id="playPauseSlide">‚ñ∂ Play</button>
              <button class="small-btn" id="nextSlide">Next ‚ñ∂</button>
            </div>

            <div style="display:flex;gap:8px;align-items:center">
              <button class="small-btn" id="playMusicBtn">Play Musik</button>
              <button class="small-btn" id="surpriseHintsBtn">Petunjuk</button>
            </div>
          </div>

          <div class="blocks">
            <div class="block" id="blockQuiz">
              <h3>Mini Quiz</h3>
              <div id="quizArea"></div>
              <div class="small muted" style="margin-top:6px">Jawab soal untuk membuka kejutan.</div>
            </div>

            <div class="block" id="blockLove">
              <h3>Love Meter</h3>
              <div class="hearts-row" id="heartsRow"></div>
              <div class="small muted" style="margin-top:6px">Klik hati sampai penuh.</div>
            </div>

            <div class="block" id="blockPin" style="grid-column:1/3">
              <h3>Catatan (PIN)</h3>
              <div style="text-align:center;margin-bottom:8px">
                <div id="pinDisplay" style="font-size:22px;letter-spacing:6px">----</div>
              </div>
              <div class="pin-pad" id="pinPad"></div>
              <div style="display:flex;justify-content:center;gap:8px;margin-top:8px">
                <button class="btn ghost" id="pinClearBtn">Reset</button>
                <button class="btn" id="pinOpenBtn">Buka Catatan</button>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>

  <!-- Mobile Edit Drawer + Buttons -->
  <button class="edit-btn" id="openMobileEdit" title="Edit">‚úèÔ∏è Edit</button>
  <button class="open-btn" id="openPreviewBtn" title="Buka Kejutan">üéÅ Buka</button>

  <div class="mobile-controls" id="mobileControls">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
      <strong>Edit</strong>
      <div style="display:flex;gap:8px">
        <button class="btn ghost" id="closeMobileEdit">Tutup</button>
      </div>
    </div>

    <div class="form-row"><label style="min-width:70px">Nama</label><input id="m_inpName" type="text"></div>
    <div class="form-row" style="margin-top:8px"><label>Dari</label><input id="m_inpFrom" type="text"></div>
    <div style="margin-top:8px"><label style="display:block;margin-bottom:6px">Pesan</label><textarea id="m_inpMsg"></textarea></div>
    <div style="margin-top:8px" class="form-row"><label>Foto</label><input id="m_inpPhoto" type="text"></div>
    <div style="margin-top:8px" class="form-row"><label>Musik</label><input id="m_inpMusic" type="text"></div>
    <div style="margin-top:8px" class="form-row"><label>PIN</label><input id="m_inpPin" type="text"></div>

    <div style="display:flex;gap:8px;margin-top:10px">
      <button class="btn" id="m_applyBtn">Terapkan</button>
      <button class="btn ghost" id="m_addSlideBtn">Tambah Slide</button>
    </div>

    <div style="margin-top:12px" class="small muted">Perubahan akan langsung terlihat saat menekan Terapkan.</div>
  </div>

  <!-- modal overlay for surprise -->
  <div class="overlay" id="overlay">
    <div class="modal" id="modalContent">
      <h2 id="modalTitle">Surprise!</h2>
      <p id="modalMessage">Selamat ulang tahun ‚Äî semoga bahagia selalu!</p>
      <img id="modalImg" src="" alt="" style="width:180px;height:180px;border-radius:12px;object-fit:cover;margin-top:12px;border:3px solid rgba(255,155,170,0.12)">
      <div style="margin-top:12px;display:flex;gap:8px;justify-content:center">
        <button class="btn" id="closeModalBtn">Tutup</button>
        <button class="btn ghost" id="pauseMusicBtn">Stop Musik</button>
      </div>
    </div>
  </div>

  <audio id="bgAudio" loop></audio>

  <script>
    /* State & defaults (same idea as before) */
    const DEFAULT = {
      name: "Sayang",
      from: "Nama Kamu",
      message: "Semoga hari ini penuh cinta dan tawa. Aku sayang kamu.",
      photo: "https://images.unsplash.com/photo-1524504388940-b1c1722653e1?q=80&w=1200&auto=format&fit=crop&ixlib=rb-4.0.3&s=placeholder",
      music: "",
      pin: "1995",
      slides: [
        "https://images.unsplash.com/photo-1524504388940-b1c1722653e1?q=80&w=1200&auto=format&fit=crop&ixlib=rb-4.0.3&s=placeholder",
        "https://images.unsplash.com/photo-1503264116251-35a269479413?q=80&w=1200&auto=format&fit=crop&ixlib=rb-4.0.3&s=placeholder",
        "https://images.unsplash.com/photo-1517841905240-472988babdf9?q=80&w=1200&auto=format&fit=crop&ixlib=rb-4.0.3&s=placeholder"
      ],
      quiz: [
        {q:"Di mana kita pertama kali bertemu?","opts":["Kafe","Kampus","Taman"],a:0},
        {q:"Makanan favorit dia?","opts":["Sushi","Nasi Goreng","Pizza"],a:1},
        {q:"Warna yang dia suka?","opts":["Biru","Merah","Hijau"],a:0}
      ]
    };

    // Elements
    const inpName = document.getElementById('inpName');
    const inpFrom = document.getElementById('inpFrom');
    const inpMsg = document.getElementById('inpMsg');
    const inpPhoto = document.getElementById('inpPhoto');
    const inpMusic = document.getElementById('inpMusic');
    const inpPin = document.getElementById('inpPin');
    const applyBtn = document.getElementById('applyBtn');

    // Mobile inputs
    const m_inpName = document.getElementById('m_inpName');
    const m_inpFrom = document.getElementById('m_inpFrom');
    const m_inpMsg = document.getElementById('m_inpMsg');
    const m_inpPhoto = document.getElementById('m_inpPhoto');
    const m_inpMusic = document.getElementById('m_inpMusic');
    const m_inpPin = document.getElementById('m_inpPin');
    const m_applyBtn = document.getElementById('m_applyBtn');

    const avatarImg = document.getElementById('avatarImg');
    const titleText = document.getElementById('titleText');
    const fromText = document.getElementById('fromText');
    const modal = document.getElementById('overlay');
    const modalTitle = document.getElementById('modalTitle');
    const modalMessage = document.getElementById('modalMessage');
    const modalImg = document.getElementById('modalImg');
    const bgAudio = document.getElementById('bgAudio');
    const playMusicBtn = document.getElementById('playMusicBtn');
    const playPauseSlide = document.getElementById('playPauseSlide');
    const prevSlide = document.getElementById('prevSlide');
    const nextSlide = document.getElementById('nextSlide');
    const slideshow = document.getElementById('slideshow');
    const quizJson = document.getElementById('quizJson');
    const loadQuizBtn = document.getElementById('loadQuizBtn');
    const quizArea = document.getElementById('quizArea');
    const heartsRow = document.getElementById('heartsRow');
    const pinDisplay = document.getElementById('pinDisplay');
    const pinPad = document.getElementById('pinPad');
    const pinClearBtn = document.getElementById('pinClearBtn');
    const pinOpenBtn = document.getElementById('pinOpenBtn');
    const openPreviewBtn = document.getElementById('openPreviewBtn');
    const resetBtn = document.getElementById('resetBtn');
    const clearProgressBtn = document.getElementById('clearProgressBtn');
    const surpriseHintsBtn = document.getElementById('surpriseHintsBtn');
    const addSlideBtn = document.getElementById('addSlideBtn');

    const leftControls = document.getElementById('leftControls');
    const mobileControls = document.getElementById('mobileControls');
    const openMobileEdit = document.getElementById('openMobileEdit');
    const closeMobileEdit = document.getElementById('closeMobileEdit');

    // State
    let state = {
      name: DEFAULT.name,
      from: DEFAULT.from,
      message: DEFAULT.message,
      photo: DEFAULT.photo,
      music: DEFAULT.music,
      slides: [...DEFAULT.slides],
      pin: DEFAULT.pin,
      quiz: [...DEFAULT.quiz],
      slideIndex: 0,
      slidePlaying: false,
      hearts: 0,
      pinInput: "",
      quizProgress: []
    };

    // init values
    function initUI(){
      inpName.value = state.name;
      inpFrom.value = state.from;
      inpMsg.value = state.message;
      inpPhoto.value = state.photo;
      inpMusic.value = state.music;
      inpPin.value = state.pin;
      quizJson.value = JSON.stringify(state.quiz, null, 2);

      // mobile inputs mirror
      m_inpName.value = state.name;
      m_inpFrom.value = state.from;
      m_inpMsg.value = state.message;
      m_inpPhoto.value = state.photo;
      m_inpMusic.value = state.music;
      m_inpPin.value = state.pin;
    }

    function renderHeader(){
      titleText.textContent = `Selamat Ulang Tahun, ${state.name} üéâ`;
      fromText.textContent = state.from;
      avatarImg.src = state.photo;
      modalImg.src = state.photo;
      modalMessage.textContent = state.message;
      document.getElementById('subText').textContent = state.message.slice(0,60) + (state.message.length>60? "‚Ä¶":"");
      bgAudio.src = state.music || "";
      pinDisplay.textContent = state.pinInput.padEnd(4, '-');
    }

    /* Slides */
    function renderSlides(){
      slideshow.innerHTML = "";
      state.slides.forEach((s,i)=>{
        const el = document.createElement('div');
        el.className = 'slide' + (i===state.slideIndex ? ' active' : '');
        const img = document.createElement('img');
        img.src = s;
        el.appendChild(img);
        slideshow.appendChild(el);
      });
    }
    function next(){ state.slideIndex = (state.slideIndex + 1) % state.slides.length; renderSlides(); }
    function prev(){ state.slideIndex = (state.slideIndex - 1 + state.slides.length) % state.slides.length; renderSlides(); }
    let slideTimer = null;
    function toggleSlidePlay(){
      state.slidePlaying = !state.slidePlaying;
      playPauseSlide.textContent = state.slidePlaying ? "‚è∏ Pause" : "‚ñ∂ Play";
      if(state.slidePlaying) slideTimer = setInterval(next, 3000);
      else clearInterval(slideTimer);
    }

    /* Quiz */
    function renderQuiz(){
      quizArea.innerHTML = "";
      state.quiz.forEach((q, qi)=>{
        const wrapper = document.createElement('div');
        wrapper.className = 'quiz-q';
        const title = document.createElement('div');
        title.textContent = (qi+1) + ". " + q.q;
        title.style.fontWeight = '700';
        title.style.marginBottom = '6px';
        wrapper.appendChild(title);
        q.opts.forEach((opt, oi)=>{
          const b = document.createElement('button');
          b.className = 'option';
          b.textContent = opt;
          b.addEventListener('click', ()=>{
            const correct = (oi === q.a);
            Array.from(wrapper.querySelectorAll('.option')).forEach(each => each.classList.remove('correct','wrong'));
            if(correct) b.classList.add('correct'); else b.classList.add('wrong');
            state.quizProgress[qi] = correct;
            checkQuizCompletion();
          });
          wrapper.appendChild(b);
        });
        quizArea.appendChild(wrapper);
      });
      state.quizProgress = state.quiz.map(()=>false);
    }
    function checkQuizCompletion(){
      const correctCount = state.quizProgress.filter(Boolean).length;
      const needed = Math.min(state.quiz.length, 2);
      if(correctCount >= needed) showHint("Quiz lengkap! Kamu dapat membuka pesan rahasia.");
    }

    /* Hearts */
    function renderHearts(){
      heartsRow.innerHTML = "";
      for(let i=0;i<6;i++){
        const h = document.createElement('div');
        h.innerHTML = '‚ù§';
        h.className = 'heart-btn';
        h.style.color = (i < state.hearts) ? 'var(--accent)' : 'rgba(91,43,56,0.18)';
        h.addEventListener('click', ()=> {
          state.hearts = Math.min(6, state.hearts + 1);
          renderHearts();
          if(state.hearts >= 6) showHint("Love meter penuh! Kamu dapat membuka kejutan.");
        });
        heartsRow.appendChild(h);
      }
    }

    /* PIN pad */
    function renderPinPad(){
      pinPad.innerHTML = "";
      const keys = ['1','2','3','4','5','6','7','8','9','0'];
      keys.forEach(k=>{
        const btn = document.createElement('div');
        btn.className = 'pin-key';
        btn.textContent = k;
        btn.addEventListener('click', ()=>{
          if(state.pinInput.length >= 4) return;
          state.pinInput += k;
          pinDisplay.textContent = state.pinInput.padEnd(4, '-');
        });
        pinPad.appendChild(btn);
      });
    }
    pinClearBtn.addEventListener('click', ()=>{
      state.pinInput = ""; pinDisplay.textContent = state.pinInput.padEnd(4, '-');
    });
    pinOpenBtn.addEventListener('click', ()=>{
      if(state.pinInput === state.pin){
        openModal("Catatan Terbuka", state.message);
        state.pinInput = ""; pinDisplay.textContent = state.pinInput.padEnd(4, '-');
      } else {
        showHint("PIN salah ‚Äî coba lagi."); state.pinInput = ""; pinDisplay.textContent = state.pinInput.padEnd(4, '-');
      }
    });

    /* Modal / surprise */
    function openModal(title, message){
      modalTitle.textContent = title || "Surprise!";
      modalMessage.textContent = message || state.message;
      modalImg.src = state.photo;
      modal.classList.add('show');
      if(bgAudio.src) { bgAudio.currentTime = 0; bgAudio.play().catch(()=>{}); }
      spawnConfetti(120);
    }
    document.getElementById('closeModalBtn').addEventListener('click', ()=>{ modal.classList.remove('show'); try{ bgAudio.pause(); }catch(e){} });
    document.getElementById('pauseMusicBtn').addEventListener('click', ()=>{ try{ bgAudio.pause(); }catch(e){} });

    /* Confetti (simple) */
    function spawnConfetti(n=80){
      const container = document.getElementById('card');
      for(let i=0;i<n;i++){
        const el = document.createElement('div');
        el.style.position='absolute';
        el.style.width=(6+Math.random()*10)+'px';
        el.style.height=(8+Math.random()*12)+'px';
        const cols=['#ff6b9a','#ff9ac9','#ffd3e6','#ffb6d8','#ffd9ef'];
        el.style.background = cols[Math.floor(Math.random()*cols.length)];
        el.style.left=(Math.random()*80+10)+'%';
        el.style.top=(Math.random()*20+10)+'%';
        el.style.opacity='1'; el.style.borderRadius='2px'; el.style.transform='translateY(0) rotate('+Math.random()*360+'deg)';
        el.style.pointerEvents='none';
        container.appendChild(el);
        const dur = 1600 + Math.random()*1400;
        const endY = 600 + Math.random()*200;
        const start = performance.now();
        (function animate(now){
          const t = Math.min(1, (now - start)/dur);
          el.style.transform = `translateY(${t*endY}px) rotate(${t*720}deg)`;
          el.style.opacity = String(1 - t);
          if(t < 1) requestAnimationFrame(animate);
          else el.remove();
        })(performance.now());
      }
    }

    /* Helpers & Events */
    applyBtn.addEventListener('click', ()=>{ applyFromInputs(); showHint("Perubahan diterapkan."); });
    function applyFromInputs(){
      state.name = inpName.value || DEFAULT.name;
      state.from = inpFrom.value || DEFAULT.from;
      state.message = inpMsg.value || DEFAULT.message;
      state.photo = inpPhoto.value || DEFAULT.photo;
      state.music = inpMusic.value || DEFAULT.music;
      state.pin = (inpPin.value && inpPin.value.trim()) ? inpPin.value.trim() : DEFAULT.pin;
      renderHeader(); renderSlides(); renderQuiz(); renderHearts(); renderPinPad();
      // mirror to mobile inputs
      m_inpName.value = state.name; m_inpFrom.value = state.from; m_inpMsg.value = state.message; m_inpPhoto.value = state.photo; m_inpMusic.value = state.music; m_inpPin.value = state.pin;
    }

    // mobile apply
    m_applyBtn.addEventListener('click', ()=>{
      // copy mobile inputs to desktop inputs then apply
      inpName.value = m_inpName.value || DEFAULT.name;
      inpFrom.value = m_inpFrom.value || DEFAULT.from;
      inpMsg.value = m_inpMsg.value || DEFAULT.message;
      inpPhoto.value = m_inpPhoto.value || DEFAULT.photo;
      inpMusic.value = m_inpMusic.value || DEFAULT.music;
      inpPin.value = m_inpPin.value || DEFAULT.pin;
      applyFromInputs();
      mobileControls.classList.remove('show');
    });

    addSlideBtn.addEventListener('click', ()=>{
      const url = prompt("Masukkan URL foto untuk slide baru:");
      if(url){ state.slides.push(url); renderSlides(); showHint("Slide ditambahkan."); }
    });
    document.getElementById('m_addSlideBtn').addEventListener('click', ()=> addSlideBtn.click());

    loadQuizBtn.addEventListener('click', ()=>{
      try{
        const parsed = JSON.parse(quizJson.value);
        if(!Array.isArray(parsed) || parsed.length === 0) throw new Error("Format quiz salah");
        state.quiz = parsed; renderQuiz(); showHint("Quiz dimuat.");
      }catch(e){ alert("Gagal memuat quiz: " + e.message); }
    });
    clearProgressBtn.addEventListener('click', ()=>{
      state.quizProgress = state.quiz.map(()=>false); state.hearts = 0; state.pinInput = ""; pinDisplay.textContent = state.pinInput.padEnd(4, '-');
      renderHearts(); renderQuiz(); showHint("Progress direset.");
    });

    playMusicBtn.addEventListener('click', ()=>{
      if(!bgAudio.src){ alert("Tidak ada musik diatur."); return; }
      if(bgAudio.paused){ bgAudio.play().catch(()=>alert('Autoplay diblokir; klik play pada overlay')); playMusicBtn.textContent="‚è∏ Stop"; }
      else { bgAudio.pause(); playMusicBtn.textContent="Play Musik"; }
    });

    prevSlide.addEventListener('click', prev);
    nextSlide.addEventListener('click', next);
    playPauseSlide.addEventListener('click', toggleSlidePlay);

    surpriseHintsBtn.addEventListener('click', ()=>{
      const hints=["Jawab quiz minimal 2 benar","Isi love meter (klik hati)","Buka catatan dengan PIN"]; showHint(hints[Math.floor(Math.random()*hints.length)]);
    });

    openPreviewBtn.addEventListener('click', ()=>{
      const correctCount = state.quizProgress.filter(Boolean).length;
      const needed = Math.min(state.quiz.length, 2);
      if(correctCount >= needed || state.hearts >= 6){
        openModal("Surprise! üéÇ", state.message);
      } else {
        showHint("Belum cukup syarat: jawab quiz minimal " + needed + " benar atau isi love meter.");
      }
    });

    resetBtn.addEventListener('click', ()=>{
      if(!confirm('Reset semua ke default?')) return;
      state = {...state, name:DEFAULT.name, from:DEFAULT.from, message:DEFAULT.message, photo:DEFAULT.photo, music:DEFAULT.music, slides:[...DEFAULT.slides], pin:DEFAULT.pin, quiz:[...DEFAULT.quiz], slideIndex:0, slidePlaying:false, hearts:0, pinInput:"", quizProgress:[]};
      initUI(); renderAll(); showHint("Sudah direset ke default.");
    });

    function showHint(text){
      let el = document.createElement('div'); el.textContent = text; el.style.position='absolute'; el.style.right='16px'; el.style.top='12px'; el.style.background='linear-gradient(90deg, rgba(255,255,255,0.9), rgba(255,250,252,0.95))'; el.style.border='1px solid rgba(91,43,56,0.06)'; el.style.padding='8px 10px'; el.style.borderRadius='8px'; el.style.fontSize='13px'; el.style.opacity='0'; el.style.transition='opacity .25s, transform .25s'; document.getElementById('card').appendChild(el); requestAnimationFrame(()=>{ el.style.opacity='1'; el.style.transform='translateY(-4px)'; }); setTimeout(()=>{ el.style.opacity='0'; el.style.transform='translateY(0)'; setTimeout(()=>el.remove(),300); }, 2200);
    }

    function renderAll(){ renderHeader(); renderSlides(); renderQuiz(); renderHearts(); renderPinPad(); }

    // Mobile edit drawer handlers
    openMobileEdit.addEventListener('click', ()=>{ m_inpName.value = inpName.value; m_inpFrom.value = inpFrom.value; m_inpMsg.value = inpMsg.value; m_inpPhoto.value = inpPhoto.value; m_inpMusic.value = inpMusic.value; m_inpPin.value = inpPin.value; mobileControls.classList.add('show'); });
    closeMobileEdit.addEventListener('click', ()=> mobileControls.classList.remove('show'));

    // small accessibility: Enter on mobile name applies
    m_inpName.addEventListener('keydown', e=>{ if(e.key==='Enter') m_applyBtn.click(); });

    // easter egg: type "love" anywhere fills hearts
    let keybuf="";
    document.addEventListener('keydown', e=>{ keybuf += e.key; if(keybuf.length>12) keybuf = keybuf.slice(-12); if(keybuf.toLowerCase().includes('love')){ state.hearts = 6; renderHearts(); showHint("Easter egg: Love penuh!"); } });

    // click slide opens modal photo
    slideshow.addEventListener('click', ()=> openModal("Foto Spesial", state.message));

    // ensure audio src changes when input changed
    inpMusic.addEventListener('change', ()=> bgAudio.src = inpMusic.value);
    m_inpMusic.addEventListener('change', ()=> bgAudio.src = m_inpMusic.value);

    // initial render
    initUI(); renderAll();
  </script>
</body>
</html>
